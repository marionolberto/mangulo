// ST61_Functions.cpp: implementation of the CST61_Functions class.
//
//////////////////////////////////////////////////////////////////////

#include "stdafx.h"
#include "SMS4DC.h"
#include "ST61_Functions.h"
#include <math.h>

#ifdef _DEBUG
#undef THIS_FILE
static char THIS_FILE[]=__FILE__;
#define new DEBUG_NEW
#endif

//////////////////////////////////////////////////////////////////////
// Construction/Destruction
//////////////////////////////////////////////////////////////////////

CST61_Functions::CST61_Functions()
{
}

CST61_Functions::~CST61_Functions()
{
}

BOOL CST61_Functions::CTRY_Check(CString str)
{
	BOOL flag = FALSE;
/*
	CString ST61ctry[] = {	"ALB","ALG","AND","AUT","AZR","BEL","BIH","BLR","BUL","CVA",
							"CYP","CZE","D  ","DNK","E  ","EGY","EST","F  ","FIN","FRO",
							"G  ","GIB","GRC","HNG","HOL","HRV","I  ","IRL","IRQ","ISL",
							"ISR","JOR","LBN","LBY","LIE","LTU","LUX","LVA","MCO","MDA",
							"MDR","MKD","MLT","MRC","NOR","POL","POR","ROU","RUS","S  ",
							"SCG","SMR","SUI","SVK","SVN","SYR","TUN","TUR","UKR"};
*/
	CString ST61ctry[] = {	"ALB","ALG","AND","AUT","AZR","BEL","BIH","BLR","BUL","CVA",
							"CYP","CZE","D  ","DNK","E  ","EGY","EST","F  ","FIN","FRO",
							"G  ","GIB","GRC","HNG","HOL","HRV","I  ","IRL","IRQ","ISL",
							"ISR","JOR","LBN","LBY","LIE","LTU","LUX","LVA","MCO","MDA",
							"MDR","MKD","MLT","MRC","NOR","POL","POR","ROU","RUS","S  ",
							"SMR","SUI","SVK","SVN","SYR","TUN","TUR","UKR","MNE","SRB"};

//	for(int i=0;i<59;i++)
	for(int i=0;i<60;i++)
		if(ST61ctry[i] == str)
			flag = TRUE;
	return flag;
}

double CST61_Functions::ST61(double f_MHz, double Perp, int p, double h1,double per1) 
{

	int Band = 0;
	double dmax = -999.999;

	if     ((f_MHz>=41.0) && (f_MHz<=68.0))
		Band = 1;
	else if((f_MHz>=87.5) && (f_MHz<=100.0))
		Band = 2;
	else if((f_MHz>=162.0) && (f_MHz<=230.0))
		Band = 3;
	else if((f_MHz>=470.0) && (f_MHz<582.0))
		Band = 4;
	else if((f_MHz>=582.0) && (f_MHz<=960.0))
		Band = 5;

	if     (Band == 1)
		dmax = TABLE_A_BAND_I( Perp,  p,  h1) ;
	else if(Band == 2)
		dmax = TABLE_B_BAND_II( Perp,  p,  h1) ;
	else if(Band == 3)
		dmax = TABLE_C_BAND_III( Perp,  p,  h1) ;
	else if(Band == 4)
	{
		if     (h1 <= 75.0)
			dmax = TABLE_D1_BAND_IV( Perp,  p,  per1) ;
		else if((h1 > 75.0)&&(h1 <= 300.0))
			dmax = TABLE_D2_BAND_IV( Perp,  p,  per1) ;
		else if((h1 > 300.0)&&(h1 <= 1200.0))
			dmax = TABLE_D3_BAND_IV( Perp,  p,  per1) ;
	}
	else if(Band == 5)
	{
		if     (h1 <= 75.0)
			dmax = TABLE_D1_BAND_V( Perp,  p,  per1) ;
		else if((h1 > 75.0)&&(h1 <= 300.0))
			dmax = TABLE_D2_BAND_V( Perp,  p,  per1) ;
		else if((h1 > 300.0)&&(h1 <= 1200.0))
			dmax = TABLE_D3_BAND_V( Perp,  p,  per1) ;
	}
	else if(Band == 0)
		dmax = -888.888;

	return dmax;
}



double CST61_Functions::TABLE_D3_BAND_V(double Perp, int p,double per1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	// (300 m < h <= 1200 m)

	if(Perp>1000000)
		return -999.999;
	Perp = max(Perp,0.1);

	double erp[]   = {0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000,1000000};

	double Land[]  = {70,85,100,115,135,160,185,215,250,290,330,375,420,470,520};
	double G20[]   = {75,95,115,130,150,180,205,235,275,315,360,400,455,505,560};
	double G40[]   = {90,110,135,160,185,220,250,285,330,370,415,455,515,575,635};
	double G60[]   = {105,140,175,205,245,285,320,365,410,455,510,570,625,690,755};
	double G80[]   = {105,155,235,305,355,410,455,515,575,640,705,775,865,930,1000};
	double G100[]  = {105,155,235,315,410,510,620,730,850,980,-999,-999,-999,-999,-999};
	double M20[]   = {85,100,120,140,160,185,220,250,285,325,365,410,460,510,565};
	double M40[]   = {115,135,155,175,200,230,270,310,350,395,435,490,555,600,650};
	double M60[]   = {160,190,215,245,275,315,360,410,455,510,565,625,700,750,810};
	double M80[]   = {235,310,345,390,440,485,540,610,680,755,830,895,965,-999,-999};
	double M100[]  = {235,315,410,510,620,725,850,980,-999,-999,-999,-999,-999,-999,-999};

	int per;
	if(per1<=20)
		per = 20;
	else if((per1>20) && (per1<=40))
		per = 40;
	else if((per1>40) && (per1<=60))
		per = 60;
	else if((per1>60) && (per1<=80))
		per = 80;
	else if(per1>80)
		per = 100;

	double D0[15];
	int i;

	if(p==1)
		for (i=0;i<15;i++)
			D0[i] = Land[i];
	else if((p==2)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = G20[i];
	else if((p==2)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = G40[i];
	else if((p==2)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = G60[i];
	else if((p==2)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = G80[i];
	else if((p==2)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = G100[i];
	else if((p==3)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = M20[i];
	else if((p==3)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = M40[i];
	else if((p==3)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = M60[i];
	else if((p==3)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = M80[i];
	else if((p==3)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = M100[i];

	double dmax = Interp1(erp,D0, Perp,15);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}


double CST61_Functions::TABLE_D3_BAND_IV(double Perp, int p,double per1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	// (300 m < h <= 1200 m)

	if(Perp>1000000)
		return -999.999;
	Perp = max(Perp,0.1);

	double erp[]   = {0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000,1000000};

	double Land[]  = {85,100,115,135,160,185,215,250,290,330,375,420,470,520,575};
	double G20[]   = {95,115,130,150,180,205,235,275,315,360,400,455,505,560,610};
	double G40[]   = {110,135,160,185,220,250,285,330,370,415,455,515,575,635,685};
	double G60[]   = {140,175,205,245,285,320,365,410,455,510,570,625,690,755,820};
	double G80[]   = {155,235,305,355,410,455,515,575,640,705,775,865,930,1000,-999};
	double G100[]  = {155,235,315,410,510,620,730,850,980,-999,-999,-999,-999,-999,-999};
	double M20[]   = {100,120,140,160,185,220,250,285,325,365,410,460,510,565,620};
	double M40[]   = {135,155,175,200,230,270,310,350,395,435,490,555,600,650,710};
	double M60[]   = {190,215,245,275,315,360,410,455,510,565,625,700,750,810,875};
	double M80[]   = {310,345,390,440,485,540,610,680,755,830,895,965,-999,-999,-999};
	double M100[]  = {315,410,510,620,725,850,980,-999,-999,-999,-999,-999,-999,-999,-999};

	int per;
	if(per1<=20)
		per = 20;
	else if((per1>20) && (per1<=40))
		per = 40;
	else if((per1>40) && (per1<=60))
		per = 60;
	else if((per1>60) && (per1<=80))
		per = 80;
	else if(per1>80)
		per = 100;

	double D0[15];
	int i;

	if(p==1)
		for (i=0;i<15;i++)
			D0[i] = Land[i];
	else if((p==2)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = G20[i];
	else if((p==2)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = G40[i];
	else if((p==2)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = G60[i];
	else if((p==2)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = G80[i];
	else if((p==2)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = G100[i];
	else if((p==3)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = M20[i];
	else if((p==3)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = M40[i];
	else if((p==3)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = M60[i];
	else if((p==3)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = M80[i];
	else if((p==3)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = M100[i];

	double dmax = Interp1(erp,D0, Perp,15);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}

double CST61_Functions::TABLE_D2_BAND_V(double Perp, int p,double per1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	// (75 m < h <= 300 m)

	if(Perp>1000000)
		return -999.999;
	Perp = max(Perp,0.1);

	double erp[]   = {0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000,1000000};

	double Land[]  = {30,40,50,65,80,100,125,150,185,220,260,300,345,395,445};
	double G20[]   = {40,50,60,75,90,115,140,165,200,235,285,330,380,420,470};
	double G40[]   = {60,70,85,95,120,145,170,205,245,285,335,385,430,475,525};
	double G60[]   = {105,125,135,140,175,200,240,285,330,380,440,490,540,600,650};
	double G80[]   = {105,155,235,290,310,350,395,455,520,585,665,715,795,860,920};
	double G100[]  = {105,155,235,315,410,510,620,725,850,980,-999,-999,-999,-999,-999};
	double M20[]   = {40,50,65,80,95,125,150,180,215,260,305,340,390,435,485};
	double M40[]   = {65,80,95,115,140,165,195,235,280,335,380,415,455,515,575};
	double M60[]   = {125,140,160,185,215,250,290,340,395,450,495,545,610,665,735};
	double M80[]   = {235,305,325,350,395,450,510,565,630,700,770,835,900,970,-999};
	double M100[]  = {235,315,410,510,620,725,850,980,-999,-999,-999,-999,-999,-999,-999};

	int per;
	if(per1<=20)
		per = 20;
	else if((per1>20) && (per1<=40))
		per = 40;
	else if((per1>40) && (per1<=60))
		per = 60;
	else if((per1>60) && (per1<=80))
		per = 80;
	else if(per1>80)
		per = 100;

	double D0[15];
	int i;

	if(p==1)
		for (i=0;i<15;i++)
			D0[i] = Land[i];
	else if((p==2)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = G20[i];
	else if((p==2)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = G40[i];
	else if((p==2)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = G60[i];
	else if((p==2)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = G80[i];
	else if((p==2)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = G100[i];
	else if((p==3)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = M20[i];
	else if((p==3)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = M40[i];
	else if((p==3)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = M60[i];
	else if((p==3)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = M80[i];
	else if((p==3)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = M100[i];

	double dmax = Interp1(erp,D0, Perp,15);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}

double CST61_Functions::TABLE_D2_BAND_IV(double Perp, int p,double per1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	// (75 m < h <= 300 m)

	if(Perp>1000000)
		return -999.999;
	Perp = max(Perp,0.1);

	double erp[]   = {0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000,1000000};

	double Land[]  = {40,50,65,80,100,125,150,185,220,260,300,345,395,445,500};
	double G20[]   = {50,60,75,90,115,140,165,200,235,285,330,380,420,470,520};
	double G40[]   = {70,85,95,120,145,170,205,245,285,335,385,430,475,525,570};
	double G60[]   = {125,135,140,175,200,240,285,330,380,440,490,540,600,650,700};
	double G80[]   = {155,235,290,310,350,395,455,520,585,665,715,795,860,920,990};
	double G100[]  = {155,235,315,410,510,620,725,850,980,-999,-999,-999,-999,-999,-999};
	double M20[]   = {50,65,80,95,125,150,180,215,260,305,340,390,435,485,550};
	double M40[]   = {80,95,115,140,165,195,235,280,335,380,415,455,515,575,645};
	double M60[]   = {140,160,185,215,250,290,340,395,450,495,545,610,665,735,815};
	double M80[]   = {305,325,350,395,450,510,565,630,700,770,835,900,970,-999,-999};
	double M100[]  = {315,410,510,620,725,850,980,-999,-999,-999,-999,-999,-999,-999,-999};

	int per;
	if(per1<=20)
		per = 20;
	else if((per1>20) && (per1<=40))
		per = 40;
	else if((per1>40) && (per1<=60))
		per = 60;
	else if((per1>60) && (per1<=80))
		per = 80;
	else if(per1>80)
		per = 100;

	double D0[15];
	int i;

	if(p==1)
		for (i=0;i<15;i++)
			D0[i] = Land[i];
	else if((p==2)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = G20[i];
	else if((p==2)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = G40[i];
	else if((p==2)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = G60[i];
	else if((p==2)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = G80[i];
	else if((p==2)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = G100[i];
	else if((p==3)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = M20[i];
	else if((p==3)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = M40[i];
	else if((p==3)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = M60[i];
	else if((p==3)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = M80[i];
	else if((p==3)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = M100[i];

	double dmax = Interp1(erp,D0, Perp,15);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}

double CST61_Functions::TABLE_D1_BAND_V(double Perp, int p,double per1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	// (h <= 75 m)

	if(Perp>1000000)
		return -999.999;
	Perp = max(Perp,0.1);

	double erp[]   = {0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000,1000000};

	double Land[]  = {15,20,25,35,45,60,80,110,150,185,230,270,310,360,410};
	double G20[]   = {25,30,40,50,60,75,100,130,170,210,250,295,340,390,430};
	double G40[]   = {50,55,65,75,90,110,140,170,210,255,310,350,395,440,490};
	double G60[]   = {105,120,130,140,155,175,205,250,305,360,410,460,510,555,600};
	double G80[]   = {105,155,235,290,310,340,385,440,505,570,640,710,775,830,895};
	double G100[]  = {105,155,235,315,410,510,620,725,850,980,-999,-999,-999,-999,-999};
	double M20[]   = {25,30,40,50,65,80,105,135,170,210,255,300,350,400,450};
	double M40[]   = {50,60,70,85,100,125,145,180,210,260,320,375,415,475,555};
	double M60[]   = {120,130,145,160,180,200,230,265,315,375,440,525,565,620,690};
	double M80[]   = {235,300,320,340,380,415,460,515,585,650,730,805,865,945,1000};
	double M100[]  = {235,315,410,510,620,725,850,980,-999,-999,-999,-999,-999,-999,-999};

	int per;
	if(per1<=20)
		per = 20;
	else if((per1>20) && (per1<=40))
		per = 40;
	else if((per1>40) && (per1<=60))
		per = 60;
	else if((per1>60) && (per1<=80))
		per = 80;
	else if(per1>80)
		per = 100;

	double D0[15];
	int i;

	if(p==1)
		for (i=0;i<15;i++)
			D0[i] = Land[i];
	else if((p==2)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = G20[i];
	else if((p==2)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = G40[i];
	else if((p==2)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = G60[i];
	else if((p==2)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = G80[i];
	else if((p==2)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = G100[i];
	else if((p==3)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = M20[i];
	else if((p==3)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = M40[i];
	else if((p==3)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = M60[i];
	else if((p==3)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = M80[i];
	else if((p==3)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = M100[i];

	double dmax = Interp1(erp,D0, Perp,15);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}


double CST61_Functions::TABLE_D1_BAND_IV(double Perp, int p,double per1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	// (h <= 75 m)

	if(Perp>1000000)
		return -999.999;
	Perp = max(Perp,0.1);

	double erp[]   = {0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000,1000000};

	double Land[]  = {20,25,35,45,60,80,110,150,185,230,270,310,360,410,465};
	double G20[]   = {30,40,50,60,75,100,130,170,210,250,295,340,390,430,490};
	double G40[]   = {55,65,75,90,110,140,170,210,255,310,350,395,440,490,540};
	double G60[]   = {120,130,140,155,175,205,250,305,360,410,460,510,555,600,650};
	double G80[]   = {155,235,290,310,340,385,440,505,570,640,710,775,830,895,945};
	double G100[]  = {155,235,315,410,510,620,725,850,980,-999,-999,-999,-999,-999,-999};
	double M20[]   = {30,40,50,65,80,105,135,170,210,255,300,350,400,450,500};
	double M40[]   = {60,70,85,100,125,145,180,210,260,320,375,415,475,555,595};
	double M60[]   = {130,145,160,180,200,230,265,315,375,440,525,565,620,690,750};
	double M80[]   = {300,320,340,380,415,460,515,585,650,730,805,865,945,1000,-999};
	double M100[]  = {315,410,510,620,725,850,980,-999,-999,-999,-999,-999,-999,-999,-999};

	int per;
	if(per1<=20)
		per = 20;
	else if((per1>20) && (per1<=40))
		per = 40;
	else if((per1>40) && (per1<=60))
		per = 60;
	else if((per1>60) && (per1<=80))
		per = 80;
	else if(per1>80)
		per = 100;

	double D0[15];
	int i;

	if(p==1)
		for (i=0;i<15;i++)
			D0[i] = Land[i];
	else if((p==2)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = G20[i];
	else if((p==2)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = G40[i];
	else if((p==2)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = G60[i];
	else if((p==2)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = G80[i];
	else if((p==2)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = G100[i];
	else if((p==3)&&(per==20))
		for (i=0;i<15;i++)
			D0[i] = M20[i];
	else if((p==3)&&(per==40))
		for (i=0;i<15;i++)
			D0[i] = M40[i];
	else if((p==3)&&(per==60))
		for (i=0;i<15;i++)
			D0[i] = M60[i];
	else if((p==3)&&(per==80))
		for (i=0;i<15;i++)
			D0[i] = M80[i];
	else if((p==3)&&(per==100))
		for (i=0;i<15;i++)
			D0[i] = M100[i];

	double dmax = Interp1(erp,D0, Perp,15);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}

double CST61_Functions::TABLE_C_BAND_III(double Perp, int p, double h1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	if(h1>1200.0)
		return -999.999;
	if(Perp>300000)
		return -999.999;
	Perp = max(Perp,0.001);

	double erp[]   = {0.001,0.003,0.01,0.03,0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000};

	double L75[]   = {20,20,20,25,30,45,60,90,120,160,210,260,310,360,420,470,530,580};
	double G75[]   = {20,20,20,25,30,45,60,90,120,160,220,280,350,430,520,610,720,810};
	double M75[]   = {20,25,30,45,60,90,120,160,220,280,350,430,520,610,720,810,910,1000};
	double L300[]  = {20,25,35,45,55,70,90,120,150,190,240,290,340,400,450,510,560,620};
	double G300[]  = {20,25,35,45,55,70,90,120,150,190,250,320,390,470,550,650,750,850};
	double M300[]  = {35,45,55,70,90,120,150,190,250,320,390,470,550,650,750,850,950,1060};
	double L1200[] = {45,60,75,90,110,130,160,190,230,270,320,360,410,470,520,580,630,690};
	double G1200[] = {45,60,75,90,110,130,160,190,230,270,330,390,460,540,630,720,820,930};
	double M1200[] = {75,90,110,130,160,190,230,270,330,390,460,540,630,720,820,930,1030,-999};

	double h;
	if(h1<=75.0)
		h = 75.0;
	else if((h1>75.0) && (h1<=300.0))
		h = 300.0;
	else if((h1>300.0) && (h1<=1200.0))
		h = 1200.0;

	double D0[18];
	int i;

	if((p==1)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = L75[i];
	else if((p==2)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = G75[i];
	else if((p==3)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = M75[i];
	else if((p==1)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = L300[i];
	else if((p==2)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = G300[i];
	else if((p==3)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = M300[i];
	else if((p==1)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = L1200[i];
	else if((p==2)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = G1200[i];
	else if((p==3)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = M1200[i];

	double dmax = Interp1(erp,D0, Perp,18);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}



double CST61_Functions::TABLE_B_BAND_II(double Perp, int p, double h1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	if(h1>1200.0)
		return -999.999;
	if(Perp>300000)
		return -999.999;
	Perp = max(Perp,0.001);

	double erp[]   = {0.001,0.003,0.01,0.03,0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000};

	double L75[]   = {20,20,20,25,30,35,40,50,60,90,120,160,210,260,310,360,420,470};
	double G75[]   = {20,20,20,25,30,35,40,50,60,90,120,160,220,280,350,430,520,620};
	double M75[]   = {20,25,30,35,40,50,60,90,120,160,220,280,350,430,520,620,720,820};
	double L300[]  = {20,25,30,40,50,60,70,80,90,120,140,190,240,290,340,400,450,510};
	double G300[]  = {20,25,30,40,50,60,70,80,90,120,140,190,250,320,390,470,550,650};
	double M300[]  = {30,40,50,60,70,80,90,120,140,190,250,320,390,470,550,650,750,850};
	double L1200[] = {40,55,65,80,90,100,120,130,160,190,230,270,320,360,410,470,520,580};
	double G1200[] = {40,55,65,80,90,100,120,130,160,190,230,270,330,390,460,540,620,720};
	double M1200[] = {65,80,90,100,120,130,160,190,230,270,330,390,460,540,620,720,820,920};

	double h;
	if(h1<=75.0)
		h = 75.0;
	else if((h1>75.0) && (h1<=300.0))
		h = 300.0;
	else if((h1>300.0) && (h1<=1200.0))
		h = 1200.0;

	double D0[18];
	int i;

	if((p==1)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = L75[i];
	else if((p==2)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = G75[i];
	else if((p==3)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = M75[i];
	else if((p==1)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = L300[i];
	else if((p==2)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = G300[i];
	else if((p==3)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = M300[i];
	else if((p==1)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = L1200[i];
	else if((p==2)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = G1200[i];
	else if((p==3)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = M1200[i];

	double dmax = Interp1(erp,D0, Perp,18);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}

double CST61_Functions::TABLE_A_BAND_I(double Perp, int p, double h1) 
{
	//p=1=='Land'  p=2=='Cold Sea' p=3=='Warm Sea'
	if(h1>1200.0)
		return -999.999;
	if(Perp>300000)
		return -999.999;
	Perp = max(Perp,0.001);

	double erp[]   = {0.001,0.003,0.01,0.03,0.1,0.3,1,3,10,30,100,300,1000,3000,10000,30000,100000,300000};
	double L75[]   = {25,25,25,35,50,70,100,130,170,220,270,320,370,430,480,540,600,660};
	double G75[]   = {25,25,25,35,50,70,100,130,170,230,300,370,450,530,630,740,830,920};
	double M75[]   = {25,35,50,70,100,130,170,230,300,370,450,530,630,740,830,920,1050,-999};
	double L300[]  = {30,35,50,60,80,100,135,160,205,260,310,360,420,465,520,565,630,680};
	double G300[]  = {30,35,50,60,80,100,135,160,205,270,330,410,490,570,670,780,870,970};
	double M300[]  = {50,60,80,100,135,160,205,270,330,410,490,570,670,780,870,970,-999,-999};
	double L1200[] = {65,80,100,120,140,160,200,240,290,330,370,420,480,540,590,650,700,760};
	double G1200[] = {65,80,100,120,140,160,200,240,290,340,410,480,560,650,750,850,950,1050};
	double M1200[] = {100,120,140,160,200,240,290,340,410,480,560,650,750,850,950,1050,-999,-999};

	double h;
	if(h1<=75.0)
		h = 75.0;
	else if((h1>75.0) && (h1<=300.0))
		h = 300.0;
	else if((h1>300.0) && (h1<=1200.0))
		h = 1200.0;

	double D0[18];
	int i;

	if((p==1)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = L75[i];
	else if((p==2)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = G75[i];
	else if((p==3)&&(h==75.0))
		for (i=0;i<18;i++)
			D0[i] = M75[i];
	else if((p==1)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = L300[i];
	else if((p==2)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = G300[i];
	else if((p==3)&&(h==300.0))
		for (i=0;i<18;i++)
			D0[i] = M300[i];
	else if((p==1)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = L1200[i];
	else if((p==2)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = G1200[i];
	else if((p==3)&&(h==1200.0))
		for (i=0;i<18;i++)
			D0[i] = M1200[i];

	double dmax = Interp1(erp,D0, Perp,18);
	if(dmax<0)
		dmax = -999.999;
	return dmax;
}

double CST61_Functions::Interp1(double *D0,double *E0,double d,int num) 
{
	double d1,d2,E1,E2,Eb;
	if (d<D0[0])
	{
		d1=D0[0];d2=D0[1];
		E1=E0[0];E2=E0[1];
	}
	else if (d>D0[num-1])
	{
		d1=D0[num-2];d2=D0[num-1];
		E1=E0[num-2];E2=E0[num-1];
	}
	else
	{
		/////////////////////////////////////////////
		int n1=0;
		while(d>=D0[n1])
		{
			n1++;
			if (n1==num)
				break;
		}
		if (n1==0)
			n1=1;
		d1=D0[n1-1];E1=E0[n1-1];
		///////////////////////////////////////////////
		int n2=num-1;
		while(d<=D0[n2])
			n2--;
		d2=D0[n2+1];E2=E0[n2+1];
		////////////////////////////////////////////////
	}
	Eb=((d1==d2) ? E1 : E1*( pow((d/d1),(log10(E2/E1)/log10(d2/d1))) ));

	return Eb;
}